export default {
  async fetch(request, env, ctx) {
    // 从环境变量获取目标URL，如果没有设置则使用默认值
    const TARGET_URL = env.TARGET_URL || "https://huggingface.co";
    
    try {
      const url = new URL(request.url);
      const targetUrl = new URL(url.pathname + url.search, TARGET_URL);

      // 创建新的请求头
      const newHeaders = new Headers(request.headers);
      newHeaders.set('Host', targetUrl.hostname);
      newHeaders.set('Referer', TARGET_URL);

      // 创建代理请求
      const proxyRequest = new Request(targetUrl, {
        method: request.method,
        headers: newHeaders,
        body: request.body,
        redirect: 'manual'
      });

      // 发送请求
      const response = await fetch(proxyRequest);
      
      // 返回响应
      return response;
      
    } catch (error) {
      return new Response(`Proxy Error: ${error.message}`, { 
        status: 502,
        headers: { 'Content-Type': 'text/plain; charset=utf-8' }
      });
    }
  }
}
