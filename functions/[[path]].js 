export async function onRequest(context) {
  // 从环境变量获取目标URL（需要在Pages设置中配置）
  const TARGET_URL = context.env.TARGET_URL || 'https://huggingface.co';

  try {
    const request = context.request;
    const url = new URL(request.url);

    // 构建目标URL
    const targetUrl = new URL(url.pathname + url.search, TARGET_URL);

    // 创建新的请求头
    const newHeaders = new Headers(request.headers);
    newHeaders.set('Host', targetUrl.hostname);
    newHeaders.set('Referer', TARGET_URL);

    // 发起代理请求
    const response = await fetch(targetUrl, {
      method: request.method,
      headers: newHeaders,
      body: request.body,
      redirect: 'manual'
    });

    // 返回响应
    return new Response(response.body, response);

  } catch (error) {
    return new Response('代理错误: ' + error.message, { status: 502 });
  }
}
