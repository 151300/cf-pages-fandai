export default {
  async fetch(request, env) {
    const targetUrl = env.TARGET_URL || 'https://default.com'; // 使用环境变量，默认值备用
    const url = new URL(request.url);
    const target = new URL(url.pathname + url.search, targetUrl);

    // 创建新请求，修正Header
    const newRequest = new Request(target, {
      method: request.method,
      headers: request.headers,
      body: request.body,
      redirect: 'manual'
    });

    try {
      const response = await fetch(newRequest);
      // 可选：修改响应头以解决CORS等问题
      const newResponse = new Response(response.body, response);
      newResponse.headers.set('Access-Control-Allow-Origin', '*');
      return newResponse;
    } catch (e) {
      return new Response('Error: ' + e.message, { status: 502 });
    }
  }
}
